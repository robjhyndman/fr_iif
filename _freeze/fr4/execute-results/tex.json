{
  "hash": "2e21c94c2b9d9baf23e72025923cdc93",
  "result": {
    "markdown": "---\ntitle: Forecast reconciliation\nsubtitle: 2. Temporal & cross-temporal forecast reconciliation\nauthor: Rob J Hyndman\npdf-engine: pdflatex\nfig-width: 9\nfig-height: 4.5\nformat:\n  beamer:\n    theme: monash\n    aspectratio: 169\n    fontsize: 14pt\n    section-titles: false\n    knitr:\n      opts_chunk:\n        dev: \"CairoPDF\"\ninclude-in-header: header.tex\ncite-method: biblatex\nbibliography: hts.bib\nbiblio-title: References\nkeep-tex: true\nexecute:\n  echo: false\n  message: false\n  warning: false\n  cache: true\n---\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-1_32f6537348dfbc0e7aeaa9ca604acec2'}\n\n:::\n\n\n## Notation reminder\n\n\\begin{textblock}{8.5}(0.2,1.5)\nEvery collection of time series with linear constraints can be written as\n\\centerline{\\colorbox[RGB]{210,210,210}{$\\bY_{t}=\\color{blue}\\bS\\color{red}\\bm{b}_{t}$}}\n\\vspace*{-0.9cm}\\begin{itemize}\\parskip=0cm\\itemsep=0cm\n  \\item $\\by_t=$ vector of all series at time $t$\n  \\item $ y_{\\text{Total},t}= $ aggregate of all series at time\n        $t$.\n  \\item $ y_{X,t}= $ value of series $X$ at time $t$.\n  \\item $\\color{red}{\\bm{b}_t}=$ vector of most disaggregated series at time $t$\n  \\item $\\color{blue}{\\bS}=$ ``summing matrix'' containing the linear constraints.\n\\end{itemize}\n\\end{textblock}\n\n\\begin{textblock}{5.7}(11.2,0.3)\n\\begin{minipage}{4cm}\n  \\begin{block}{}\\centering\n    \\begin{tikzpicture}\n      \\tikzstyle{every node}=[ellipse,draw,fill=red!15,inner sep=2pt]\n      \\tikzstyle[level distance=.3cm]\n      \\tikzstyle[sibling distance=12cm]\n      \\tikzstyle{level 1}=[sibling distance=10mm,font=\\small,set style={{every node}+=[fill=blue!15]}]\n      \\node{Total}[edge from parent fork down]\n      child {node {A}\n        }\n      child {node {B}\n        }\n      child {node {C}\n        };\n    \\end{tikzpicture}\n  \\end{block}\n\\end{minipage}\n\\end{textblock}\n\n\\only<1>{\\begin{textblock}{5.7}(9.2,2.8)\\fontsize{14}{15}\\sf\n  \\begin{align*}\n    \\bY_{t} & = \\begin{pmatrix}\n                  y_{\\text{Total},t} \\\\\n                  y_{A,t}            \\\\\n                  y_{B,t}            \\\\\n                  y_{C,t}\n                \\end{pmatrix}                             \\\\\n            & = {\\color{blue}\\underbrace{\\begin{pmatrix}\n                                              1 & 1 & 1 \\\\\n                                              1 & 0 & 0 \\\\\n                                              0 & 1 & 0 \\\\\n                                              0 & 0 & 1\n                                            \\end{pmatrix}}_{\\bS}}\n    {\\color{red}\\underbrace{\\begin{pmatrix}\n                                y_{A,t} \\\\y_{B,t}\\\\y_{C,t}\n                              \\end{pmatrix}}_{\\bm{b}_{t}}}\n  \\end{align*}\n\\end{textblock}}\n\\only<2>{\\begin{textblock}{5.7}(9.2,3.3)\\fontsize{14}{15}\\sf\n  \\begin{alertblock}{}\n    \\begin{itemize}\\itemsep=0.1cm\n      \\item Base forecasts: $\\hat{\\bm{y}}_{T+h|T}$\n      \\item Reconciled forecasts: $\\tilde{\\bm{y}}_{T+h|T}=\\bS\\bm{G}\\hat{\\bm{y}}_{T+h|T}$\n      \\item MinT: $\\bG = (\\bS'\\bm{W}_h^{-1}\\bS)^{-1}\\bS'\\bm{W}_h^{-1}$ where $\\bm{W}_h$ is covariance matrix of base forecast errors.\n    \\end{itemize}\n  \\end{alertblock}\n\\end{textblock}}\n\n# Temporal reconciliation\n\n## Temporal reconciliation\n\n\\begin{textblock}{7}(1,1.9)\n\\begin{tikzpicture}\n  \\tikzstyle{every node}=[ellipse,draw,inner sep=0.2pt,fill=red!15,font=\\small]\n  \\tikzstyle[level distance=.1cm]\n  \\tikzstyle[sibling distance=3cm]\n  \\tikzstyle{level 1}=[sibling distance=18mm,set style={{every node}+=[fill=yellow]}]\n  \\node{Annual}[edge from parent fork down]\n  child {node {Q$_1$}}\n  child {node {Q$_2$}}\n  child {node {Q$_3$}}\n  child {node {Q$_4$}};\n\\end{tikzpicture}\n\\end{textblock}\n\n\\begin{textblock}{8.5}(8.3,1.9)\\fontsize{14}{17}\\sf\n$$\\bm{y}_\\tau =\n  \\begin{bmatrix}\n    x_{\\tau}^{[2]}  \\\\[0.2cm]\n    x_{\\tau,1}^{[1]} \\\\[0.2cm]\n    x_{\\tau,2}^{[1]} \\\\[0.2cm]\n    x_{\\tau,3}^{[1]} \\\\[0.2cm]\n    x_{\\tau,2}^{[1]}\n  \\end{bmatrix}\n  \\qquad\n  \\bm{S} = \\begin{bmatrix}\n    1 & 1 & 1 & 1 \\\\[0.2cm]\n    1 & 0 & 0 & 0 \\\\[0.2cm]\n    0 & 1 & 0 & 0 \\\\[0.2cm]\n    0 & 0 & 1 & 0 \\\\[0.2cm]\n    0 & 0 & 0 & 1\n  \\end{bmatrix}\n$$\n\\end{textblock}\n\n## Temporal reconciliation\n\n\\begin{textblock}{7}(0.1,1.9)\n\\begin{tikzpicture}\n  \\tikzstyle{every node}=[ellipse,draw,inner sep=0.2pt,fill=red!15,font=\\small]\n  \\tikzstyle[level distance=.1cm]\n  \\tikzstyle[sibling distance=3cm]\n  \\tikzstyle{level 1}=[sibling distance=42mm,set style={{every node}+=[fill=blue!15]}]\n  \\tikzstyle{level 2}=[sibling distance=18mm,set style={{every node}+=[fill=yellow]}]\n  \\node{Annual}[edge from parent fork down]\n  child {node {Semi-Annual$_1$}\n      child {node {Q$_1$}}\n      child {node {Q$_2$}}\n    }\n  child {node {Semi-Annual$_2$}\n      child {node {Q$_3$}}\n      child {node {Q$_4$}}\n    };\n\\end{tikzpicture}\n\\end{textblock}\n\n\\begin{textblock}{8.5}(8.3,1.9)\\fontsize{14}{17}\\sf\n$$\\bm{y}_\\tau =\n  \\begin{bmatrix}\n    x_{\\tau}^{[2]}  \\\\[0.2cm]\n    x_{\\tau,1}^{[2]} \\\\[0.2cm]\n    x_{\\tau,2}^{[2]} \\\\[0.2cm]\n    x_{\\tau,1}^{[1]} \\\\[0.2cm]\n    x_{\\tau,2}^{[1]} \\\\[0.2cm]\n    x_{\\tau,3}^{[1]} \\\\[0.2cm]\n    x_{\\tau,2}^{[1]}\n  \\end{bmatrix}\n  \\qquad\n  \\bm{S} = \\begin{bmatrix}\n    1 & 1 & 1 & 1 \\\\[0.2cm]\n    1 & 1 & 0 & 0 \\\\[0.2cm]\n    0 & 0 & 1 & 1 \\\\[0.2cm]\n    1 & 0 & 0 & 0 \\\\[0.2cm]\n    0 & 1 & 0 & 0 \\\\[0.2cm]\n    0 & 0 & 1 & 0 \\\\[0.2cm]\n    0 & 0 & 0 & 1\n  \\end{bmatrix}\n$$\n\\end{textblock}\n\n## Temporal reconciliation\n\n\\only<1>{\\begin{tikzpicture}\n  \\tikzstyle{every node}=[ellipse,draw,inner sep=0.2pt,fill=red!15,font=\\small]\n  \\tikzstyle[level distance=.1cm]\n  \\tikzstyle[sibling distance=7cm]\n  \\tikzstyle{level 1}=[sibling distance=72mm,set style={{every node}+=[fill=blue!15]}]\n  \\tikzstyle{level 2}=[sibling distance=36mm,set style={{every node}+=[fill=yellow]}]\n  \\tikzstyle{level 3}=[sibling distance=12mm,font=\\scriptsize,set style={{every node}+=[fill=green]}]\n  \\node{Annual}[edge from parent fork down]\n  child {node {Semi-Annual$_1$}\n      child {node {Q$_1$}\n          child {node {\\scriptsize M$_1$}}\n          child {node {\\scriptsize M$_2$}}\n          child {node {\\scriptsize M$_3$}}\n        }\n      child {node {Q$_2$}\n          child {node {\\scriptsize M$_4$}}\n          child {node {\\scriptsize M$_5$}}\n          child {node {\\scriptsize M$_6$}}\n        }\n    }\n  child {node {Semi-Annual$_2$}\n      child {node {Q$_3$}\n          child {node {\\scriptsize M$_7$}}\n          child {node {\\scriptsize M$_8$}}\n          child {node {\\scriptsize M$_9$}}\n        }\n      child {node {Q$_4$}\n          child {node {\\scriptsize M$_{10}$}}\n          child {node {\\scriptsize M$_{11}$}}\n          child {node {\\scriptsize M$_{12}$}}\n        }\n    };\n\\end{tikzpicture}}\n\\only<2->{\\begin{tikzpicture}\n  \\tikzstyle{every node}=[ellipse,draw,inner sep=0.2pt,fill=red!15,font=\\small]\n  \\tikzstyle[level distance=.1cm]\n  \\tikzstyle[sibling distance=7cm]\n  \\tikzstyle{level 1}=[sibling distance=48mm,set style={{every node}+=[fill=blue!15]}]\n  \\tikzstyle{level 2}=[sibling distance=24mm,set style={{every node}+=[fill=yellow]}]\n  \\tikzstyle{level 3}=[sibling distance=12mm,set style={{every node}+=[fill=green]}]\n  \\node{Annual}[edge from parent fork down]\n  child {node {FourM$_1$}\n      child {node {BiM$_1$}\n          child {node {\\scriptsize M$_1$}}\n          child {node {\\scriptsize M$_2$}}\n        }\n      child {node {BiM$_2$}\n          child {node {\\scriptsize M$_3$}}\n          child {node {\\scriptsize M$_4$}}\n        }\n    }\n  child {node {FourM$_2$}\n      child {node {BiM$_3$}\n          child {node {\\scriptsize M$_5$}}\n          child {node {\\scriptsize M$_6$}}\n        }\n      child {node {BiM$_4$}\n          child {node {\\scriptsize M$_7$}}\n          child {node {\\scriptsize M$_8$}}\n        }\n    }\n  child {node {FourM$_3$}\n      child {node {BiM$_5$}\n          child {node {\\scriptsize M$_9$}}\n          child {node {\\scriptsize M$_{10}$}}\n        }\n      child {node {BiM$_6$}\n          child {node {\\scriptsize M$_{11}$}}\n          child {node {\\scriptsize M$_{12}$}}\n        }\n    };\n\\end{tikzpicture}}\\pause\n\n\\only<3>{\\begin{textblock}{14}(1,6.7)\n  \\begin{alertblock}{}\n    \\begin{itemize}\n      \\item[\\color{white}\\ding{229}] Forecast series at each available frequency.\n      \\item[\\color{white}\\ding{229}] Optimally combine forecasts within the same year.\n    \\end{itemize}\n  \\end{alertblock}\n\\end{textblock}}\n\n## Temporal reconciliation\n\\fontsize{11}{11}\\sf\n\n$$\n\t\\bm{y}_\\tau=\\begin{bmatrix}\n\t\tx_{\\tau}^{[12]}     \\\\[0.2cm]\n\t\t\\bm{x}_{\\tau}^{[6]} \\\\[0.2cm]\n\t\t\\bm{x}_{\\tau}^{[4]} \\\\[0.2cm]\n\t\t\\bm{x}_{\\tau}^{[3]} \\\\[0.2cm]\n\t\t\\bm{x}_\\tau^{[2]}   \\\\[0.2cm]\n\t\t\\bm{x}_\\tau^{[1]}\n\t\\end{bmatrix}\n\t\\qquad\n\t\\bm{S} = \\begin{bmatrix}\n\t\t1                & 1 & 1 & 1 & 1~~~1~~~1~~~1 & 1 & 1 & 1 & 1 \\\\\n\t\t1                & 1 & 1 & 1 & 1~~~1~~~0~~~0 & 0 & 0 & 0 & 0 \\\\\n\t\t0                & 0 & 0 & 0 & 0~~~0~~~1~~~1 & 1 & 1 & 1 & 1 \\\\\n\t\t1                & 1 & 1 & 1 & 0~~~0~~~0~~~0 & 0 & 0 & 0 & 0 \\\\\n\t\t0                & 0 & 0 & 0 & 1~~~1~~~1~~~1 & 0 & 0 & 0 & 0 \\\\\n\t\t0                & 0 & 0 & 0 & 0~~~0~~~0~~~0 & 1 & 1 & 1 & 1 \\\\\n\t\t1                & 1 & 1 & 0 & 0~~~0~~~0~~~0 & 0 & 0 & 0 & 0 \\\\\n\t\t                 &   &   &   & \\vdots        &   &   &   &   \\\\\n\t\t0                & 0 & 0 & 0 & 0~~~0~~~0~~~0 & 0 & 1 & 1 & 1 \\\\\n\t\t1                & 1 & 0 & 0 & 0~~~0~~~0~~~0 & 0 & 0 & 0 & 0 \\\\\n\t\t                 &   &   &   & \\vdots        &   &   &   &   \\\\\n\t\t0                & 0 & 0 & 0 & 0~~~0~~~0~~~0 & 0 & 0 & 1 & 1 \\\\[0.2cm]\n\t\t\\phantom{\\vdots} &   &   &   & \\bm{I}_{12}   &   &   &   &\n\t\\end{bmatrix}\n$$\n\n## Temporal reconciliation\n\\fontsize{14}{15}\\sf\n\nFor a time series  $y_1,\\dots,y_T$, observed at frequency $m$:\n\\begin{alertblock}{}\\vspace*{-0.1cm}\n$$\n  x_j^{[k]} = \\sum_{t = (j-1)k+1}^{jk} y_t\\qquad \\text{for $j = 1,\\dots,\\lfloor T/k\\rfloor$}\n$$\n\\end{alertblock}\n* $k \\in \\mathcal{K} = \\{k_1,\\dots,k_p\\}$ denote the $p$ factors of $m$ in ascending order, where $k_1=1$ and $k_p=m$\n* $x_j^{[1]} = y_t$\n* A single unique hierarchy is only possible when there are no coprime pairs in $\\mathcal{K}$.\n* $M_k=m/k$ is seasonal period of aggregated series.\n\n## Temporal reconciliation\n\\fontsize{14}{15}\\sf\\vspace*{-0.8cm}\n$$\\bm{x}_\\tau = \\bm{S} \\bm{x}_\\tau^{[1]}, \\qquad \\bm{S} = \\begin{bmatrix}\\bm{A}\\\\\\bm{I}\\end{bmatrix}$$\nwhere\n$$\n\\bm{x}_\\tau = \\begin{bmatrix*}[l]\n\t\t{x_\\tau^{[k_p]}}\\\\\n\t\t{\\bm{x}_\\tau^{[k_{p-1}]}}\\\\\n\t\t\\quad\\vdots\\\\\n\t\t{\\bm{x}_\\tau^{[k_1]}}\\\\\n\t\\end{bmatrix*}\\qquad\n\t\\bm{x}_\\tau^{[k]} = \\begin{bmatrix*}[l]\n\t\tx_{M_k(\\tau-1)+1}^{[k]}\\\\\n\t\tx_{M_k(\\tau-1)+2}^{[k]}\\\\\n\t\t\\quad\\vdots\\\\\n\t\tx_{M_k\\tau}^{[k]}\n\t\\end{bmatrix*}\\qquad\n\\bm{A} =\n\t\\begin{bmatrix}\n\t\t\\bm{1}'_m                                    \\\\\n\t\t\\bm{I}_{m/k_{p-1}} \\otimes \\bm{1}'_{k_{p-1}} \\\\\n\t\t\\vdots                                       \\\\\n\t\t\\bm{I}_{m/k_{2}} \\otimes \\bm{1}'_{k_{2}}     \\\\\n\t\\end{bmatrix}\n$$\n$\\tau$ is time index for most aggregated series,\n\n$k\\in \\mathcal{K} = \\{k_1,\\dots,k_p\\}$,\\quad $k_1=1$,\\quad $k_p=m$,\\quad $\\tau=1,\\dots,T/m$.\n\n# Temporal reconciliation: thief package\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{9.5}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-2_f4a27f1b72a15a1da91addd5a672cfd0'}\n\n```{.r .cell-code}\nlibrary(thief)\nUSAccDeaths\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Jan   Feb   Mar   Apr   May   Jun   Jul   Aug   Sep   Oct   Nov   Dec\n1973  9007  8106  8928  9137 10017 10826 11317 10744  9713  9938  9161  8927\n1974  7750  6981  8038  8422  8714  9512 10120  9823  8743  9129  8710  8680\n1975  8162  7306  8124  7870  9387  9556 10093  9620  8285  8466  8160  8034\n1976  7717  7461  7767  7925  8623  8945 10078  9179  8037  8488  7874  8647\n1977  7792  6957  7726  8106  8890  9299 10625  9302  8314  8850  8265  8796\n1978  7836  6892  7791  8192  9115  9434 10484  9827  9110  9070  8633  9240\n```\n:::\n\n```{.r .cell-code}\nthief(USAccDeaths, usemodel = \"arima\", comb = \"struc\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Jan   Feb   Mar   Apr   May   Jun   Jul   Aug   Sep   Oct   Nov   Dec\n1979  8185  7381  8132  8516  9393  9764 10881 10060  9182  9405  8869  9361\n1980  8406  7602  8352  8737  9614  9985 11101 10280  9403  9626  9090  9581\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-3_33933034e7648fb6614d76a486bda660'}\n\n```{.r .cell-code}\n# Construct aggregates\naggts <- tsaggregates(USAccDeaths)\naggts[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n       Jan   Feb   Mar   Apr   May   Jun   Jul   Aug   Sep   Oct   Nov   Dec\n1973  9007  8106  8928  9137 10017 10826 11317 10744  9713  9938  9161  8927\n1974  7750  6981  8038  8422  8714  9512 10120  9823  8743  9129  8710  8680\n1975  8162  7306  8124  7870  9387  9556 10093  9620  8285  8466  8160  8034\n1976  7717  7461  7767  7925  8623  8945 10078  9179  8037  8488  7874  8647\n1977  7792  6957  7726  8106  8890  9299 10625  9302  8314  8850  8265  8796\n1978  7836  6892  7791  8192  9115  9434 10484  9827  9110  9070  8633  9240\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-4_9c97c01ca304ba0446bad43ab8b76915'}\n\n```{.r .cell-code}\naggts[[2]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime Series:\nStart = c(1973, 1) \nEnd = c(1978, 6) \nFrequency = 6 \n [1] 17113 18065 20843 22061 19651 18088 14731 16460 18226 19943 17872 17390 15468 15994\n[15] 18943 19713 16751 16194 15178 15692 17568 19257 16525 16521 14749 15832 18189 19927\n[29] 17164 17061 14728 15983 18549 20311 18180 17873\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-5_105bf99bd17249a6d12697e42edfe998'}\n\n```{.r .cell-code}\naggts[[3]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      Qtr1  Qtr2  Qtr3  Qtr4\n1973 26041 29980 31774 28026\n1974 22769 26648 28686 26519\n1975 23592 26813 27998 24660\n1976 22945 25493 27294 25009\n1977 22475 26295 28241 25911\n1978 22519 26741 29421 26943\n```\n:::\n:::\n\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-6_2a680e38045ac223b82137c21801959a'}\n\n```{.r .cell-code}\naggts[[4]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime Series:\nStart = c(1973, 1) \nEnd = c(1978, 3) \nFrequency = 3 \n [1] 35178 42904 37739 31191 38169 35262 31462 38656 32945 30870 36825 33046 30581 38116\n[15] 34225 30711 38860 36053\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-7_fc9a81f653650fb3f96ea8410f6a803a'}\n\n```{.r .cell-code}\naggts[[5]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime Series:\nStart = c(1973, 1) \nEnd = c(1978, 2) \nFrequency = 2 \n [1] 56021 59800 49417 55205 50405 52658 48438 52303 48770 54152 49260 56364\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-8_bb1221c5677003886537475a680a8fd6'}\n\n```{.r .cell-code}\naggts[[6]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nTime Series:\nStart = 1973 \nEnd = 1978 \nFrequency = 1 \n[1] 115821 104622 103063 100741 102922 105624\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-9_b044542b700791170c3f93a292213002'}\n\n```{.r .cell-code}\n# Compute forecasts\nfc <- list()\nfor(i in seq_along(aggts)) {\n  fc[[i]] <- forecast(auto.arima(aggts[[i]]), h=2*frequency(aggts[[i]]))\n}\nreconciled <- reconcilethief(fc)\nreconciled[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         Point Forecast Lo 80 Hi 80 Lo 95 Hi 95\nJan 1979           8185  7774  8597  7556  8814\nFeb 1979           7381  6908  7854  6657  8105\nMar 1979           8132  7604  8660  7324  8939\nApr 1979           8516  7938  9094  7632  9400\nMay 1979           9393  8770 10017  8440 10347\nJun 1979           9764  9098 10430  8746 10783\nJul 1979          10881 10175 11587  9801 11961\nAug 1979          10060  9316 10804  8922 11197\nSep 1979           9182  8403  9962  7990 10375\nOct 1979           9405  8591 10219  8160 10650\nNov 1979           8869  8022  9716  7573 10165\nDec 1979           9361  8482 10240  8016 10705\nJan 1980           8406  7432  9380  6917  9895\nFeb 1980           7602  6571  8633  6025  9178\nMar 1980           8352  7267  9438  6692 10012\nApr 1980           8737  7600  9874  6998 10476\nMay 1980           9614  8427 10800  7799 11429\nJun 1980           9985  8751 11219  8097 11872\nJul 1980          11101  9822 12381  9144 13059\nAug 1980          10280  8957 11604  8256 12305\nSep 1980           9403  8036 10770  7313 11493\nOct 1980           9626  8218 11034  7472 11779\nNov 1980           9090  7642 10538  6875 11305\nDec 1980           9581  8094 11069  7307 11856\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-10_58ba984f582f2b5de0beec4ba39afc6e'}\n\n```{.r .cell-code}\nreconciled[[2]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Point Forecast Lo 80 Hi 80 Lo 95 Hi 95\n1979.00          15566 14789 16344 14377 16756\n1979.17          16648 15634 17661 15098 18197\n1979.33          19157 17954 20361 17317 20998\n1979.50          20941 19573 22308 18849 23032\n1979.67          18587 17073 20101 16272 20903\n1979.83          18230 16583 19877 15710 20749\n1980.00          16007 14159 17856 13181 18834\n1980.17          17089 15077 19101 14013 20165\n1980.33          19599 17436 21761 16291 22906\n1980.50          21382 19078 23686 17858 24906\n1980.67          19029 16592 21466 15302 22756\n1980.83          18671 16108 21234 14751 22591\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-11_ac238ac30cbab016ec46bec5fa46becb'}\n\n```{.r .cell-code}\nreconciled[[3]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Point Forecast Lo 80 Hi 80 Lo 95 Hi 95\n1979 Q1          23698 22461 24935 21806 25590\n1979 Q2          27673 25924 29423 24997 30349\n1979 Q3          30123 27980 32266 26846 33401\n1979 Q4          27635 25161 30110 23851 31419\n1980 Q1          24360 20860 27859 19008 29712\n1980 Q2          28335 24049 32621 21780 34890\n1980 Q3          30785 25836 35734 23216 38354\n1980 Q4          28297 22764 33830 19835 36759\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-12_1687070ad3e80a64e48d6ccfdbfa9d69'}\n\n```{.r .cell-code}\nreconciled[[4]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Point Forecast Lo 80 Hi 80 Lo 95 Hi 95\n1979.00          32214 30197 34231 29129 35299\n1979.33          40098 37245 42951 35735 44461\n1979.67          36817 33324 40311 31474 42161\n1980.00          33096 27760 38433 24935 41258\n1980.33          40980 34290 47671 30749 51212\n1980.67          37700 29888 45512 25752 49648\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-13_0921c2fbf9a563c8cddf8c095263bc5e'}\n\n```{.r .cell-code}\nreconciled[[5]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n        Point Forecast Lo 80 Hi 80 Lo 95 Hi 95\n1979.00          51371 48111 54631 46386 56357\n1979.50          57758 53148 62368 50707 64809\n1980.00          52695 44710 60680 40483 64907\n1980.50          59082 48773 69391 43316 74848\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-14_cce6dfaa0d1010d1794ebc644d6dc2ce'}\n\n```{.r .cell-code}\nreconciled[[6]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n     Point Forecast  Lo 80  Hi 80  Lo 95  Hi 95\n1979         109129 102287 115972  98665 119594\n1980         111777 104934 118619 101312 122241\n```\n:::\n:::\n\n\n## Temporal reconciliation: thief package\n\\fontsize{10}{11}\\sf\n\n\n::: {.cell hash='fr4_cache/beamer/unnamed-chunk-15_b7ac883672519e34270d73f26f173273'}\n::: {.cell-output-display}\n![](fr4_files/figure-beamer/unnamed-chunk-15-1.pdf)\n:::\n:::\n\n\n# Temporal reconciliation: Examples\n\n## Temporal reconciliation: M3 monthly series\n\n* Apply temporal reconciliation to all 1428 monthly series from M3 competition\n* Forecast horizon $h=18$ months\n* ETS and ARIMA models\n* Measure percentage difference to base forecasts\n* Reconciliation methods:\n  * WLS$_H$ (diagonal)\n  * WLS$_V$ (diagonal with common variances for same frequency)\n  * WLS$_S$ (diagonal/structural)\n\n## Temporal reconciliation: M3 monthly series\n\\fontsize{9}{9}\\sf\\vspace*{-0.2cm}\n\n\\hspace*{-0.8cm}\n\\begin{tabular}{lr@{\\hskip 0.2cm}rrrrrrrr@{\\hskip 0.2cm}rrrrrr}\nAggregation & & & \\multicolumn{6}{c}{ETS} & & \\multicolumn{5}{c}{ARIMA} \\\\\n\\cmidrule{4-9}\\cmidrule{11-16}\nlevel & $h$ & & Base & & BU & WLS$_H$ & WLS$_V$ & WLS$_S$ & & Base & & BU & WLS$_H$ & WLS$_V$ & WLS$_S$\\\\\n\\midrule\n & & & \\multicolumn{13}{c}{RMAE}\\\\[0.05cm]\nAnnual           & 1  & & 1.0 & & -19.6 &      -22.0 &      -22.0 & {\\bf-25.1}      & & 1.0 & &  -28.6 &      -33.1 &      -32.8 &    {\\bf -33.4} \\\\\nSemi-annual      & 3  & & 1.0 & &   0.6 &       -4.0 &       -3.6 & {\\bf -5.4}      & & 1.0 & &   -3.4 &       -8.2 &       -8.3 &   {\\bf  -9.9} \\\\\nFour-monthly     & 4  & & 1.0 & &   2.0 &       -2.4 &       -2.2 & {\\bf -3.0}      & & 1.0 & &   -1.7 &       -5.5 &       -5.9 &   {\\bf  -6.7} \\\\\nQuarterly        & 6  & & 1.0 & &   2.4 &       -1.6 &       -1.7 & {\\bf -2.8}      & & 1.0 & &   -3.6 &       -7.2 &       -8.1 &   {\\bf  -9.1} \\\\\nBi-monthly       & 9  & & 1.0 & &   0.7 &       -2.9 &       -3.3 & {\\bf -4.3}      & & 1.0 & &   -1.5 &       -4.4 &       -5.3 &   {\\bf  -6.3} \\\\\nMonthly          & 18 & & 1.0 & &   0.0 &       -2.2 &       -3.2 & {\\bf -3.9}      & & 1.0 & &    0.0 &       -0.9 &       -2.9 &   {\\bf  -3.4}  \\\\[0.01cm]\n\\textit{Average} &    & &   & & \\textit{-2.3} & \\textit{-5.9} & \\textit{-6.0} & {\\bf\\textit{-7.4}} & &      & & \\textit{-6.5} & \\textit{-9.9} & \\textit{-10.5} & {\\bf\\textit{ -11.5}} \\\\[0.1cm]\n & & & \\multicolumn{13}{c}{MASE}\\\\[0.05cm]\nAnnual           & 1  & &  1.1  & &     -12.1 &      -17.9 &   -17.8 &  {\\bf -18.5}  & &       1.3 & &     -25.4 &      -29.9 &      -29.9 &  {\\bf -30.2}\\\\\nSemi-annual      & 3  & &  1.0  & &       0.0 &       -6.3 &    -6.0 &  {\\bf  -6.9}  & &       1.1 & &      -2.9 &       -8.1 &       -8.2 &  {\\bf  -9.4}\\\\\nFour-monthly     & 4  & &  0.9  & &       3.1 &       -3.2 &    -3.0 &  {\\bf  -3.4}  & &       0.9 & &      -1.8 &       -6.2 &       -6.5 &  {\\bf  -7.1}\\\\\nQuarterly        & 6  & &  0.9  & &       3.2 &       -2.8 &    -2.7 &  {\\bf  -3.4}  & &       1.0 & &      -2.6 &       -6.9 &       -7.4 &  {\\bf  -8.1}\\\\\nBi-monthly       & 9  & &  0.9  & &       2.7 &       -2.9 &    -3.0 &  {\\bf  -3.7}  & &       0.9 & &      -1.3 &       -5.0 &       -5.5 &  {\\bf  -6.3}\\\\\nMonthly          & 18 & &  0.9  & &       0.0 &       -3.7 &    -4.6 &  {\\bf  -5.0}  & &       0.9 & &       0.0 &       -1.9 &       -3.2 &  {\\bf  -3.7}\\\\ [0.01cm]\n\\textit{Average} &    & &       & & \\textit{-0.5} & \\textit{-6.1} & \\textit{-6.2} & {\\bf\\textit{-6.8}} & &      & & \\textit{-5.7} & \\textit{-9.7} & \\textit{-10.1} & {\\bf\\textit{ -10.8}}\n\\end{tabular}\n\n## Example: Accident & emergency services demand\n\nWeekly A\\&E demand data: 7 November 2010 to 7 June 2015.\\fontsize{11}{11.5}\\sf\n\n\\begin{tabular}{l}\n\t\\toprule\n\tType 1 Departments --- Major A\\&E                               \\\\\n\tType 2 Departments --- Single Specialty                         \\\\\n\tType 3 Departments --- Other A\\&E/Minor Injury Unit             \\\\\n\tTotal Attendances                                               \\\\\n\tType 1 Departments --- Major A\\&E $>$ 2 hours                   \\\\\n\tType 2 Departments --- Single Specialty $>$ 2 hours             \\\\\n\tType 3 Departments --- Other A\\&E/Minor Injury Unit $>$ 2 hours \\\\\n\tTotal Attendances $>$ 2 hours                                   \\\\\n\tEmergency Admissions via Type 1 A\\&E                            \\\\\n\tTotal Emergency Admissions via A\\&E                             \\\\\n\tOther Emergency Admissions (i.e not via A\\&E)                   \\\\\n\tTotal Emergency Admissions                                      \\\\\n\tNumber of patients spending $>$ 2 hours from decision to admit to admission\n\\end{tabular}\n\n## Example: Accident & emergency services demand\n\n\\placefig{2.2}{2.2}{height=6.5cm, width=14cm}{AEexample.pdf}\n\n\\begin{textblock}{10}(3,1)\\fontsize{12}{12}\\sf\n\t\\begin{block}{}\\centering\n\t\tTotal emergency admissions via A\\&E\n\t\\end{block}\n\\end{textblock}\n\n## Example: Accident & emergency services demand\n\nTest set: last 52 weeks\n\n\\alert{MASE comparison} (ARIMA models)\n\n\\begin{tabular}{llllr}\n  \\toprule\n  Aggr. Level & $h$   & Base & Reconciled & Change  \\\\\n  \\midrule\n  Annual & 1     \t& 3.4   & 1.9   & $-42.9\\%$ \\\\\n  Weekly & 1--52 \t& 2.0   & 1.9   & $-5.0\\%$ \\\\\n  Weekly & 13    \t& 2.3   & 1.9   & $-16.2\\%$ \\\\\n  Weekly & 4     \t& 1.9   & 1.5   & $-18.6\\%$ \\\\\n  Weekly & 1     \t& 1.6   & 1.3   & $-17.2\\%$ \\\\\n\\end{tabular}\n\n# Cross-temporal reconciliation\n\n## Cross-temporal forecast reconciliation\n\n\\begin{tikzpicture}[baseline=(current  bounding  box.center),\n  rel/.append style={shape=ellipse,\n    draw=black,\n  minimum width=1.5cm,\n  minimum height=1cm},\n  rel2/.append style={shape=rectangle,\n    draw=black,\n  minimum width=1.5cm,\n  minimum height=1cm},\n  connection/.style ={inner sep =0, outer sep =0}]\n\n  \\node[rel] at (0, 0) (X){$y_{X,t}$};\n  \\node[rel] at (2, 0) (Y){$y_{Y,t}$};\n  \\node[rel] at (1, 1.5) (Tt){$y_{T,t}$};\n\n  \\relation{0.2}{X}{Tt};\n  \\relation{0.2}{Y}{Tt};\n\n\n  \\node[rel2] at (5, 0) (AA){$y_{i,4\\tau-3}$};\n  \\node[rel2] at (7, 0) (AB){$y_{i,4\\tau-2}$};\n  \\node[rel2] at (9, 0) (BA){$y_{i,4\\tau-1}$};\n  \\node[rel2] at (11, 0) (BB){$y_{i,4\\tau}$};\n\n  \\node[rel2] at (6, 1.5) (A){$x_{i,2\\tau-1}^{[2]}$};\n  \\node[rel2] at (10, 1.5) (B){$x_{i,2\\tau}^{[2]}$};\n  \\node[rel2] at (8, 3) (T){$x_{i,\\tau}^{[4]}$};\n\n  \\relation{0.2}{AA}{A};\n  \\relation{0.2}{AB}{A};\n  \\relation{0.2}{BA}{B};\n  \\relation{0.2}{BB}{B};\n\n  \\relation{0.2}{A}{T};\n  \\relation{0.2}{B}{T};\n\\end{tikzpicture}\\vspace*{0.7cm}\n\n* $n=3$, $n_a = 1$, $n_b = 2$\n* Quarterly series: $m = 2$, $\\mathcal{K} = \\{1,2,4\\}$\n\n## Cross-temporal reconciliation\n\n* $\\bm{y}_t=$ series at most temporally disaggregated level, including all cross-sectionally disaggregated and aggregated series.\n* $y_{i,t}=$ $i$th element of $\\bm{y}_t$, $i=1,\\dots,n$.\n* For each $i$, we can expand $y_{i,t}$ to include all temporally aggregated variants:\n$$\\bm{x}_{i,\\tau} = \\begin{bmatrix}\n\t\t{x_{i,\\tau}^{[k_p]}} \\\\\n\t\t\\vdots               \\\\\n\t\t{\\bm{x}_{i,\\tau}^{[k_1]}}\n\t\\end{bmatrix}\\qquad\n\\bm{x}_\\tau = \\begin{bmatrix}\n\t\t\\bm{x}_{1,\\tau} \\\\\n\t\t\\vdots          \\\\\n\t\t\\bm{x}_{n,\\tau}\n\t\\end{bmatrix}.$$\n\n## Cross-temporal reconciliation\n\n\\alert{Structural matrix approach}\n\n* $\\bm{S}_{cs}=$ structural cross-sectional matrix\n* $\\bm{S}_{te}=$ structural temporal matrix\n* $\\bm{S}_{ct} = \\bm{S}_{cs} \\otimes \\bm{S}_{te}$\n\n$$\\bm{x}_\\tau = \\bm{S}_{ct} \\bm{b}_\\tau,\\qquad\\text{where}\\qquad\n\\bm{b}_\\tau = \\begin{bmatrix}\n\t\t{\\bm{x}_{1,\\tau}^{[1]}} \\\\\n\t\t\\vdots                  \\\\\n\t\t{\\bm{x}_{n,\\tau}^{[1]}}\n\t\\end{bmatrix}.\n$$\n\n## Cross-temporal forecast reconciliation\n\n\\full{Smatrix}\n\n\\begin{textblock}{5}(0.5,1.5)\n\\begin{block}{}\n\\centerline{$\\bm{S}_{cs} \\otimes \\bm{S}_{te} = \\bm{S}_{ct}$}\n\\end{block}\n\\end{textblock}\n\n## Cross-temporal reconciliation\n\n\\alert{Constraint matrix approach}\n\n* $\\bm{C}_{cs}=$ cross-sectional constraint matrix\n* $\\bm{C}_{te}=$ temporal constraint matrix\n\n$$\\bm{C}_{ct}\\bm{x}_\\tau = \\bm{0}\\qquad\\text{where}\\qquad\n\\bm{C}_{ct} = \\begin{bmatrix}\n\t\t(\\bm{0}_{(n_a m\\times nk^\\ast)} ~~ \\bm{I}_m \\otimes \\bm{C}_{cs})\\bm{P}' \\\\\n\t\t\\bm{I}_n \\otimes \\bm{C}_{te}\n\t\\end{bmatrix}\n$$\n\n* $k^\\ast = \\displaystyle\\sum_{k \\in \\mathcal{K}\\setminus\\{k_1\\}} \\frac{m}{k}$\n* $\\bm{P}=$ the commutation matrix such that $\\bm{P} \\text{vec}(\\bm{Y}_{\\tau}) = \\text{vec}(\\bm{Y}_{\\tau}')$.\n\n# Cross-temporal probabilistic forecast reconciliation\n\n##  Cross-temporal probabilistic forecast reconciliation\n\n\\input{figs/res_boot.tex}\n\n\\begin{textblock}{2}(13.5,3)\n\\begin{block}{}\n\\textcolor[HTML]{7fb97f}{Year 1}\\\\\n\\textcolor[HTML]{7fbcff}{Year 2}\\\\\n\\textcolor[HTML]{e87f7f}{Year 3}\\\\\n\\textcolor[HTML]{7f7f7f}{Year 4}\n\\end{block}\n\\end{textblock}\n\n##  Cross-temporal probabilistic forecast reconciliation\n\\vspace*{-0.4cm}\n\n\\input{figs/ct_boot.tex}\n\n\n## Thanks!\n\n\\placefig{0}{1.4}{trim = 10 45 0 0, clip=TRUE, width=10cm, height=2.5cm}{roman}\n\\placefig{2}{1.4}{trim = 20 20 0 0, clip=TRUE, width=10cm, height=2.7cm}{george}\n\\placefig{4}{1.4}{trim = 0 10 0 0, clip=TRUE, width=10cm, height=2.5cm}{hanlin}\n\\placefig{6}{1.4}{trim = 10 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{earowang}\n\\placefig{8}{1.4}{trim = 0 15 0 0, clip=TRUE, width=10cm, height=2.5cm}{alanlee}\n\\placefig{10}{1.4}{trim = 30 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{mitch}\n\\placefig{12}{1.4}{trim = 15 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{shanika}\n\\placefig{14}{1.4}{trim = 40 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{tas}\n\n\\placefig{0}{3.9}{trim = 30 10 30 0, clip=TRUE, width=10cm, height=2.5cm}{puwasala}\n\\placefig{2}{3.9}{trim = 0 10 0 0, clip=TRUE, width=10cm, height=2.5cm}{fotios}\n\\placefig{4}{3.9}{trim = 100 30 50 20, clip=TRUE, width=10cm, height=2.5cm}{nikos}\n\\placefig{6}{3.9}{trim = 50 30 0 0, clip=TRUE, width=10cm, height=2.5cm}{souhaib}\n\\placefig{8}{3.9}{trim = 110 40 50 0, clip=TRUE, width=10cm, height=2.5cm}{james}\n\\placefig{10}{3.9}{trim = 40 40 0 0, clip=TRUE, width=10cm, height=2.5cm}{mahdi}\n\\placefig{12}{3.9}{trim = 50 50 0 0, clip=TRUE, width=10cm, height=2.5cm}{christoph}\n\\placefig{14}{3.9}{trim = 50 50 0 20, clip=TRUE, width=10cm, height=2.5cm}{fin}\n\n\\placefig{0}{6.4}{trim = 10 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{berwin}\n\\placefig{2}{6.4}{trim = 10 20 0 0, clip=TRUE, width=10cm, height=2.5cm}{galit}\n\\placefig{4}{6.4}{trim = 10 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{mahsa}\n\\placefig{6}{6.4}{trim = 10 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{florian}\n\\placefig{8}{6.4}{trim = 30 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{evan}\n\\placefig{10}{6.4}{trim = 5 5 0 0, clip=TRUE, width=10cm, height=2.5cm}{vassilis}\n\\placefig{12}{6.4}{trim = 90 0 0 0, clip=TRUE, width=10cm, height=2.5cm}{carla}\n\\placefig{14}{6.4}{trim = 0 40 0 0, clip=TRUE, width=10cm, height=2.5cm}{pablo}\n\n## More information\n\\fontsize{18}{20}\\sf\n\n\\href{https://robjhyndman.com/fr2023}{\\includegraphics[width=0.5cm]{figs/slide}\\, robjhyndman.com/fr2023}\n\n\\href{https://robjhyndman.com}{\\faicon{home} robjhyndman.com}\n\n\\href{https://twitter.com/robjhyndman}{\\faicon{twitter} @robjhyndman}\n\n\\href{https://aus.social/@robjhyndman}{\\includegraphics[width=0.5cm]{figs/mastodon}\\, aus.social/@robjhyndman}\n\n\\href{https://github.com/robjhyndman}{\\faicon{github}  @robjhyndman}\n\n\\href{mailto:rob.hyndman@monash.edu}{\\faicon{envelope}  rob.hyndman@monash.edu}\n\n\\begin{textblock}{6.2}(0,8.8)\\pgfsetfillopacity{0.65}\n\\begin{beamercolorbox}[wd=4.7cm]{block body}\n\\fontsize{6}{6}\\sf\\color[RGB]{72,45,34}\\href{https://www.flaticon.com/free-icons/presentation}{Presentation icon created by orvipixel - Flaticon}\n\t\\end{beamercolorbox}\n\\end{textblock}\n\n\n\\nocite{Di_FonGir2022a,temporal-hierarchies}\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}